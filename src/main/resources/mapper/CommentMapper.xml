<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.myblog.mapper.CommentMapper">

    <resultMap id="resultComment" type="com.myblog.entity.Comment">
        <id property="id" column="id"/>
        <result property="nickname" column="nickname"/>
        <result property="email" column="email"/>
        <result property="content" column="content"/>
        <result property="createTime" column="create_time"/>
        <result property="pid" column="pid"/>
        <result property="replyCommentId" column="reply_CommentId"/>
        <result property="articleId" column="articleId"/>
        <result property="status" column="status"/>
        <result property="avatar" column="avatar"/>
        <result property="replyId" column="replyId"/>
        <result property="replyNickname" column="replyNickname"/>
        <result property="os" column="os"/>
    </resultMap>
    <!--开发sg_ 服务器qiu_-->
    <insert id="insertComment" parameterType="com.myblog.entity.Comment">
        insert into myblog.t_comment
        (nickname,email,content,create_time,pid,replyCommentId,articleId,status,avatar,replyId,replyNickname,os)
        values (#{nickname},#{email},#{content},#{create_time},#{pid},#{replyCommentId},#{articleId},#{status},#{avatar},#{replyId},#{replyNickname},#{os})
    </insert>

    <select id="findCommentCount" resultType="com.myblog.entity.Comment">
        select count(*) from myblog.t_comment
        <if test="articleId != null">
            and type=2 and article_id = #{articleId}
        </if>
        <if test="articleId==null">
            and type=1
        </if>
    </select>

    <select id="findAllComment" resultType="Integer">
        select count(*) from myblog.t_comment
        where status = 1 and pid = 0
        <if test="articleId != null">
            and replyCommentId = 2 and articleId = #{articleId}
        </if>
        <if test="articleId == null">
            and replyCommentId = 1
        </if>
        order by create_time desc
        limit #{pageNow},#{pageSize}
    </select>

    <!--查询二级子评论-->
    <select id="findChildrenComment" resultMap="resultComment">
        select * from myblog.t_comment where status = 1 and pid = #{pId}
    </select>
</mapper>