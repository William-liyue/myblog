<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>博客管理</title>
    <link href="" th:href="@{/favicon.ico}" rel="icon" type="image/x-ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/../../css/style.css" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="/../../lib/layui-v2.6.8/layui/css/layui.css"
          tppabs="http://res.layui.com/layui/dist/css/layui.css"  media="all">
    <style type="text/css">
        body .layui-body {
            top: 10px;
            left: 100px;
            right: -100px;
        }
    </style>
</head>
<body>

<!--中间内容-->
<div class="container">
    <div class="row">
        <form class="layui-col-xs12 layui-layout-admin">
            <div class="layui-header layui-bg-green">
                <div class="layui-logo layui-hide-xs layui-bg-black">后台管理</div>
                <!--导航栏-->
                <ul class="layui-nav layui-layout-left">
                    <!--移动端显示-->
                    <li class="layui-nav-item layui-show-xs-inline-block layui-hide-sm" lay-hander-event="menuLeft">
                        <i class="layui-icon layui-icon-spread-left"></i>
                    </li>
                    <li class="layui-nav-item layui-hide-xs"><a href="#" th:href="@{/admin/Admin}">首页</a></li>
                    <li class="layui-nav-item">
                        <a href="javascript:;" th:href="@{/admin/blogs}">文章管理</a>
                        <dl id="success" class="layui-nav-child">
                            <dd><a href="#" th:href="@{/admin/blogs/input}">新增</a></dd>
                        </dl>
                    </li>
                    <li class="layui-nav-item layui-hide-xs"><a href="javascript:;" th:href="@{/admin/types}">分类管理</a></li>
                    <li class="layui-nav-item layui-hide-xs"><a href="javascript:;" th:href="@{/admin/friendlinks}">友链</a></li>
                    <li class="layui-nav-item layui-hide-xs"><a href="javascript:;" th:href="@{/admin/resources}">资源管理</a></li>
                    <li class="layui-nav-item layui-hide-xs">
                        <a href="javascript:;">nav groups</a>
                        <dl class="layui-nav-child">
                            <dd><a href="#" th:href="@{/admin/resources/input}">新增</a></dd>
                            <dd><a href="#" th:href="@{/admin/resources}">列表</a></dd>
                        </dl>
                    </li>
                </ul>
                <ul class="layui-nav layui-layout-right">
                    <li class="layui-nav-item layui-hide layui-show-md-inline-block">
                        <a href="javascript:;">
                            <img src="" class="layui-nav-img">
                            <span th:text="${session.user.nickname}">MyBLog</span>
                        </a>
                        <dl class="layui-nav-child">
                            <dd><a href="">Your Profile</a></dd>
                            <dd><a href=""><i class="layui-icon">&#xe716;</i>设置</a></dd>
                            <dd><a href="#" th:href="@{/admin/logout}" class="item">退出登录</a></dd>
                        </dl>
                    </li>
                    <li class="layui-nav-item" lay-header-event="menuRight" lay-unselect>
                        <a href="javascript:;">
                            <i class="layui-icon layui-icon-more-vertical"></i>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="layui-side layui-bg-black">
                <div class="layui-side-scroll">
                    <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
                    <ul class="layui-nav layui-nav-tree layui-menu-item-down" lay-filter="test">
                        <li class="layui-nav-item layui-nav-itemed">
                            <a class="" href="javascript:;">menu group 1</a>
                            <dl class="layui-nav-child">
                                <dd><a href="javascript:;">menu 1</a></dd>
                                <dd><a href="javascript:;">menu 2</a></dd>
                                <dd><a href="javascript:;">menu 3</a></dd>
                                <dd><a href="">the links</a></dd>
                            </dl>
                        </li>
                        <li class="layui-nav-item">
                            <a href="javascript:;">menu group 2</a>
                            <dl class="layui-nav-child">
                                <dd><a href="javascript:;">list 1</a></dd>
                                <dd><a href="javascript:;">list 2</a></dd>
                                <dd><a href="">超链接</a></dd>
                            </dl>
                        </li>
                        <li class="layui-nav-item"><a href="javascript:;">click menu item</a></li>
                        <li class="layui-nav-item"><a href="">the links</a></li>
                    </ul>
                </div>
            </div>
            <div class="layui-body">
                <!-- 内容主体区域 -->
                <div class="layui-menu-lg layui-show">
                    <div id="LAY_preview">
                        <div>
                            <div data-method="confirmTrans" th:text="|提示：${message}" class="layui-btn">配置一个透明的询问框</div>
                        </div>
                        <div class="demoTable">
                            <select class="layui-btn layui-icon layui-font-20" type="hidden" name="typeId" th:value="*{typeId}">
                                <option>原创</option>
                                <option>转载</option>
                                <option>翻译</option>
                            </select>
                            <div class="layui-inline">
                                <input class="layui-input layui-input" type="text" name="title" id="Reload" autocomplete="off" placeholder="请输入标题" th:value="*{title}">
                            </div>
                            <button id="clear-btn" class="layui-btn layui-btn-warm">clear</button>
                            <div class="layui-inline">
                                <input type="checkbox" name="" id="flexCheckDefault">
                                <label class="form-check-label" for="flexCheckDefault">推荐</label>
                                <button class="layui-btn" type="button" id="search-btn" data-type="reload">搜索</button>
                            </div>
                        </div>
                        <div>
                            <table class="layui-hide" id="LAY_table_user" lay-data="{url: '/test/demo'}" lay-filter="LAY_table_user">

                            </table>
                        </div>
                        <script type="text/html" id="toolbar">
                            <div class="layui-btn-container">
                                <button class="layui-btn layui-btn-sm" lay-event="getCheckData">获取选中行数据</button>
                                <button class="layui-btn layui-btn-sm" lay-event="getCheckLength">获取选中数目</button>
                                <button class="layui-btn layui-btn-sm" lay-event="isAll">验证是否全选</button>
                            </div>
                        </script>
                        <script type="text/html" id="tool">
                            <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
                            <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
                            <!-- 这里同样支持 laytpl 语法，如： -->
                            {{#  if(d.auth > 2){ }}
                            <a class="layui-btn layui-btn-xs" lay-event="check">审核</a>
                            {{#  } }}
                        </script>
                        <!--<div class="layui-show-lg-block">
                            <table class="text-center table table-striped table-sm">
                                <thead>
                                <tr class="text-center">
                                    <th scope="col">ID</th>
                                    <th scope="col">标题</th>
                                    <th scope="col">类型</th>
                                    <th scope="col">方式</th>
                                    <th scope="col">状态</th>
                                    <th scope="col">更新时间</th>
                                    <th scope="col">操作</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr class="text-center" th:each="blog,iterStat : ${pageInfo.list}">
                                    <td th:text="${iterStat.count}">#</td>
                                    <td th:text="${blog.title}">#</td>
                                    <td th:text="${blog.TypeId}">#</td>
                                    <td th:text="${blog.recommend} ? '是':'否'">#</td>
                                    <td th:text="${blog.published} ? '发布' : '保存'">#</td>
                                    <td th:text="${#dates.format(blog.updateTime,'yyyy-MM-dd HH:mm')}">#</td>
                                    <td>
                                        <a href="#" th:href="@{/admin/blogs/{id}/input(id=${blog.id})}"
                                           class="layui-btn layui-btn-radius">编辑</a>
                                        <a href="#" th:href="@{/admin/blogs/{id}/delete(id=${blog.id})}"
                                           onclick="return confirm('确定删除该文章吗！')"
                                           class="layui-btn layui-btn-radius layui-btn-danger">删除</a>
                                    </td>
                                </tr>
                                </tbody>
                                <tfoot>
                                <tr>
                                    <th colspan="10">
                                        <div class="btn btn-group">
                                            <div class="nav-link three text-center">
                                                <a class="item btn btn-secondary"
                                                   th:href="@{/admin/blogs(pageNum=${pageInfo.hasPreviousPage} ? ${pageInfo.prePage}:1)}"
                                                   th:unless="${pageInfo.isFirstPage}">上一页</a>
                                            </div>
                                            <div class="nav-link disabled ten">
                                                <p>第 <span th:text="${pageInfo.pageNum}"></span> 页，共 <span
                                                        th:text="${pageInfo.pages}"></span>
                                                    有 <span th:text="${pageInfo.total}"></span> 篇文章</p>
                                            </div>
                                            <div class="nav-link three text-center">
                                                <a class="item btn btn-secondary"
                                                   th:href="@{/admin/blogs(pageNum=${pageInfo.hasNextPage} ? ${pageInfo.nextPage}:${pageInfo.pages})}"
                                                   th:unless="${pageInfo.isLastPage}">下一页</a>
                                            </div>
                                        </div>
                                    </th>
                                </tr>
                                </tfoot>
                            </table>
                        </div>-->
                    </div>
                </div>
            </div>
            <div class="layui-footer">
                <!-- 底部固定区域 -->
                <p class="text-center">Copyright©2020-2021
                    <a href="" target="_blank" rel="nofollow" style="color: #B4BF42">湘ICP</a>
                    <a href="" target="_blank" rel="nofollow" style="color: #B4BF42"><img src="" alt="">湘公网</a>
                </p>
            </div>
        </form>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.2/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
<!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
<!--[if lt IE 9]>
<script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
<script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<script src="/../../lib/layui-v2.6.8/layui/layui.js" charset="UTF-8"></script>
<script>
    $('#blog-container').load(/*[[@{/footer/blog}]]*/"/footer/blog");

    $('.message .close')
        .on('click', function () {
            $(this)
                .closest('.message')
                .transition('fade');
        });

    function page(obj) {
        $("[name='page']").val($(obj).data("page"));
        loaddata();
    }

    $('#clear-btn')
        .on('click', function() {
            $('.type.dropdown')
                .dropdown('clear')
            ;
        })
    ;

    $("#search-btn")
        .click('click', function () {
        $("[name='page']").val(0);
        loaddata();
    });

    function loaddata() {
        $("#table-container").load(/*[[@{/admin/blogs/search}]]*/"/admin/blogs/search", {
            title: $("[name='title']").val(),
            typeId: $("[name='typeId']").val(),
            tagId: $("[name='tagId']").val(),
            page: $("[name='page']").val()
        });
    }
</script>
<div id="LAY_layedit_code">
    <script>
        layui.use(['element', 'layer', 'util', 'table', 'jquery'], function(){
            var element = layui.element
                ,util = layui.util
            //头部事件
            util.event('lay-header-event', {
                //左侧菜单事件
                menuLeft: function(othis){
                    layer.msg('展开左侧菜单的操作', {icon: 0});
                }
                ,menuRight: function(){
                    layer.open({
                        type: 1
                        ,content: '<div style="padding: 15px;">处理右侧面板的操作</div>'
                        ,area: ['260px', '100%']
                        ,offset: 'rt' //右上角
                        ,anim: 5
                        ,shadeClose: true
                    });
                }
            });
            var table = layui.table;
            //方法级渲染
            table.render({
                // 通过ID选选择器获取页面元素
                elem: '#LAY_table_user',
                // method: 'post',
                // 数据接口url
                url: 'http://localhost:8080/admin/blogs',
                // 开启分页
                page: {
                    first: '首页',
                    prev: '上一页',
                    next: '下一页',
                    last: '末页'
                },
                // 默认显示10条记录
                limit: 10,
                limits: [10, 20, 30, 40, 50, 60, 70, 80, 90, 100],
                minWidth: 1000,
                minHeight: 600,
                parseData: function(res){ //res 即为原始返回的数据
                    return {
                        "code": res.status, //解析接口状态
                        "msg": res.message, //解析提示文本
                        "count": res.total, //解析数据长度
                        "data": res.data.item //解析数据列表
                    };
                },
                request: {
                    pageName: 'curr' //页码的参数名称，默认：page
                    ,limitName: 'nums' //每页数据量的参数名，默认：limit
                },
                response: {
                    statusName: 'status' //规定数据状态的字段名称，默认：code
                    ,statusCode: 200 //规定成功的状态码，默认：0
                    ,msgName: 'hint' //规定状态信息的字段名称，默认：msg
                    ,countName: 'total' //规定数据总数的字段名称，默认：count
                    ,dataName: 'rows' //规定数据列表的字段名称，默认：data
                },
                toolbar: '#toolbar', //开启头部工具栏，并为其绑定左侧模板
                defaultToolbar: ['filter', 'exports', 'print', {    //自定义头部工具栏右侧图标。如无需自定义，去除该参数即可
                    title: '提示',
                    layEvent: 'LAYTABLE_TIPS',
                    icon: 'layui-icon-tips'
                }],
                title: '用户数据表',
                cols: [
                    [   // 表头
                        {
                            type: 'checkbox',   // 类型
                            field: 'id',        // 对象的属性名字 获取该属性的值
                            title: 'ID',        // 标题
                            sort: 'true',       // 排序
                            fixed: 'left'       // 位置 left center right
                        }
                        ,{field:'id', title:'ID', width:80, sort: true}
                        ,{field:'title', title:'标题', width:130}
                        ,{field:'TypeId', title:'类型', width:120}
                        ,{field:'recommend', title:'方式', width:130}
                        ,{field:'published', title:'状态', width:100}
                        ,{field:'update', title:'更新时间', width: 150, sort: true}
                        ,{fixed: '#dates.format(blog.updateTime,\'yyyy-MM-dd HH:mm\')', title:'操作', width:150}
                    ]
                ]
            });
            //头工具栏事件
            table.on('toolbar', function(obj){
                var checkStatus = table.checkStatus(obj.config.id);
                var data = checkStatus.data;
                switch(obj.event){
                    case 'getCheckData':
                        layer.alert(JSON.stringify(data));
                        break;
                    case 'getCheckLength':
                        layer.msg('选中了：'+ data.length + ' 个');
                        break;
                    case 'isAll':
                        layer.msg(checkStatus.isAll ? '全选': '未全选');
                        break;

                    //自定义头工具栏右侧图标 - 提示
                    case 'LAYTABLE_TIPS':
                        layer.alert('这是工具栏右侧自定义的一个图标按钮');
                        break;
                }
            });
            //监听行工具事件
            table.on('tool', function(obj){     // tool 是工具条事件名，test 是 table 原始容器的属性 lay-filter="对应的值"
                var data = obj.data;            // 获取当前行数据
                var layEvent = obj.event;       // 获得lay-event对应的值
                var tr = obj.tr;                // 获得当前行tr的DOM对象(如果有的话)
                console.log(obj);
                if (layEvent === 'detail') {            // 查看
                    // do somehing
                } else if(layEvent === 'del'){         // 删除
                    layer.confirm('真的删除行么', function(index){
                        obj.del();                      // 删除对应行（tr）的DOM结构，并更新缓存
                        layer.close(index);
                        // 向服务端发送删除指令
                    });
                } else if(layEvent === 'edit'){        // 编辑
                    // do somehing
                    // 同步更新缓存对应的值
                    layer.prompt({
                        formType: 2
                        ,value: data.title
                    }, function(value, index){
                        obj.update({
                            title: value
                        });
                        layer.close(index);
                    });
                }
            });
            var $ = layui.$, active = {
                reload: function () {
                    var Reload = $('#Reload');
                    table.reload('Reload', {
                        page: {
                            curr: 1 // 重新从第1页开始
                        },
                        where: {
                            key: {
                                id: Reload.val()
                            }
                        }
                    });
                }
            };
            $('.demoTable .layui-btn').on('click', function () {
                var type = $(this).data('type');
                active[type] ? active[type].call(this) : '';
            });
        });
    </script>
</div>
</body>
</html>